<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–≤—ñ—Ç—ñ–≤ –ø—Ä–æ –¥—Ä–æ–Ω–∏</title>
    <meta name="description" content="–ó–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–≤—ñ—Ç—ñ–≤ –ø—Ä–æ –¥—Ä–æ–Ω–∏">
    <meta name="theme-color" content="#4facfe">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –ª–æ–≥—ñ–Ω–∞/—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
    <div id="authSection" class="auth-section">
        <div class="auth-container">
            <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–≤—ñ—Ç—ñ–≤ –ø—Ä–æ –¥—Ä–æ–Ω–∏</h1>
            
            <!-- –§–æ—Ä–º–∞ –ª–æ–≥—ñ–Ω–∞ -->
            <div id="loginForm" class="auth-form">
                <h2>–í—Ö—ñ–¥</h2>
                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="loginUsername">–õ–æ–≥—ñ–Ω:</label>
                        <input type="text" id="loginUsername" required placeholder="–í–∞—à –ª–æ–≥—ñ–Ω">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="submit" class="btn btn-primary">–£–≤—ñ–π—Ç–∏</button>
                    <!-- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤–∏–º–∫–Ω–µ–Ω–∞ - –∞–∫–∞—É–Ω—Ç–∏ –¥–æ–¥–∞—é—Ç—å—Å—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º -->
                    <!-- <p class="auth-switch">–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É? <a href="#" id="showRegister">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</a></p> -->
                </form>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –≤–∏–º–∫–Ω–µ–Ω–∞ - –∞–∫–∞—É–Ω—Ç–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –ë–î -->
            <!-- 
            <div id="registerForm" class="auth-form" style="display: none;">
                <h2>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
                <form id="registerFormElement">
                    <div class="form-group">
                        <label for="registerUsername">–õ–æ–≥—ñ–Ω:</label>
                        <input type="text" id="registerUsername" required placeholder="–í–∞—à –ª–æ–≥—ñ–Ω" pattern="[a-zA-Z0-9_-]{3,20}" title="3-20 —Å–∏–º–≤–æ–ª—ñ–≤: –ª—ñ—Ç–µ—Ä–∏, —Ü–∏—Ñ—Ä–∏, _ –∞–±–æ -">
                    </div>
                    <div class="form-group">
                        <label for="registerName">–Ü–º'—è (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                        <input type="text" id="registerName" placeholder="–í–∞—à–µ —ñ–º'—è">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="registerPassword" required placeholder="–ú—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤">
                    </div>
                    <div class="form-group">
                        <label for="registerPasswordConfirm">–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="registerPasswordConfirm" required placeholder="–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
                    </div>
                    <button type="submit" class="btn btn-primary">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
                    <p class="auth-switch">–í–∂–µ —î –∞–∫–∞—É–Ω—Ç? <a href="#" id="showLogin">–£–≤—ñ–π—Ç–∏</a></p>
                </form>
            </div>
            -->
        </div>
    </div>

    <!-- –ì–æ–ª–æ–≤–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ (–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –ª–æ–≥—ñ–Ω–∞) -->
    <div id="appSection" class="container" style="display: none;">
        <header>
            <div class="header-content">
                <div>
                    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–≤—ñ—Ç—ñ–≤ –ø—Ä–æ –¥—Ä–æ–Ω–∏</h1>
                    <p>–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—ñ—Ç—É</p>
                </div>
                <div class="user-info">
                    <span id="userEmailDisplay"></span>
                    <button id="logoutBtn" class="btn btn-outline btn-small">–í–∏–π—Ç–∏</button>
                </div>
            </div>
            
            <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è -->
            <nav class="main-nav">
                <button class="nav-tab" data-page="submission">
                    <span class="nav-label">–ü–æ–¥–∞–Ω–Ω—è</span>
                </button>
                <button class="nav-tab active" data-page="generator">
                    <span class="nav-label">–ù–æ–≤–∏–π –∑–≤—ñ—Ç</span>
                </button>
                <button class="nav-tab" data-page="archive">
                    <span class="nav-label">–ê—Ä—Ö—ñ–≤</span>
                </button>
                <button class="nav-tab" data-page="settings">
                    <span class="nav-label">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</span>
                </button>
            </nav>
            
            <!-- –ü–µ—Ä–µ–º–∏–∫–∞—á —Ä–æ–∑—à–∏—Ä–µ–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞) -->
            <div class="advanced-mode-toggle" id="advancedModeSection">
                <label class="switch-label">
                    <input type="checkbox" id="advancedModeSwitch">
                    <span class="switch-slider"></span>
                    <span class="switch-text" title="–£–≤—ñ–º–∫–Ω—ñ—Ç—å —â–æ–± –≤–∏–¥–∞–ª—è—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –æ–ø—Ü—ñ—ó –∑ üë§üóëÔ∏è. –ü—Ä–æ—Å—Ç–æ –≤–∏–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é –∑ –∫–æ—Ä–∑–∏–Ω–æ—é –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è.">–†–æ–∑—à–∏—Ä–µ–Ω—ñ</span>
                </label>
            </div>
        </header>

        <!-- –°–µ–∫—Ü—ñ—è: –ü–æ–¥–∞–Ω–Ω—è -->
        <section id="submissionSection" class="page-section">
            <h2>–ü–æ–¥–∞–Ω–Ω—è –Ω–∞ —á–µ—Ä–≥—É–≤–∞–Ω–Ω—è</h2>
            <div class="submission-content">
                <form id="submissionForm" class="submission-form">
                    <!-- –ü–µ—Ä—ñ–æ–¥ —á–µ—Ä–≥—É–≤–∞–Ω–Ω—è -->
                    <div class="form-group-row">
                        <div class="form-group">
                            <label for="dutyDateFrom">–ß–µ—Ä–≥—É–≤–∞–Ω–Ω—è –∑:</label>
                            <input type="date" id="dutyDateFrom" required>
                        </div>
                        <div class="form-group">
                            <label for="dutyDateTo">–ß–µ—Ä–≥—É–≤–∞–Ω–Ω—è –ø–æ:</label>
                            <input type="date" id="dutyDateTo" required>
                        </div>
                    </div>

                    <!-- –°–∫–ª–∞–¥ –µ–∫—ñ–ø–∞–∂—É -->
                    <div class="form-group">
                        <label>–°–∫–ª–∞–¥ –µ–∫—ñ–ø–∞–∂—É:</label>
                        <div id="crewMembers" class="crew-checkboxes">
                            <p class="loading-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ç–æ—Ä—ñ–≤...</p>
                        </div>
                        <small class="form-hint">–û–±–µ—Ä—ñ—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä—ñ–≤ –¥–ª—è —á–µ—Ä–≥—É–≤–∞–Ω–Ω—è</small>
                    </div>

                    <!-- –ó–∞—Å–æ–±–∏ (–î—Ä–æ–Ω–∏) -->
                    <div class="form-group">
                        <h3>–ó–∞—Å–æ–±–∏ (–î—Ä–æ–Ω–∏)</h3>
                        <div id="dronesContainer" class="resources-container">
                            <button type="button" class="btn btn-outline" id="addDroneBtn">+ –î–æ–¥–∞—Ç–∏ –¥—Ä–æ–Ω</button>
                        </div>
                    </div>

                    <!-- –ë–æ—î–∫–æ–º–ø–ª–µ–∫—Ç -->
                    <div class="form-group">
                        <h3>–ë–æ—î–∫–æ–º–ø–ª–µ–∫—Ç (–ë–ö)</h3>
                        <div id="bkContainer" class="resources-container">
                            <button type="button" class="btn btn-outline" id="addBkBtn">+ –î–æ–¥–∞—Ç–∏ –ë–ö</button>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∏ –¥—ñ–π -->
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">–ó–±–µ—Ä–µ–≥—Ç–∏ –ø–æ–¥–∞–Ω–Ω—è</button>
                        <button type="button" id="shareSubmission" class="btn btn-outline">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</button>
                        <button type="reset" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç–∏</button>
                        <button type="button" id="closeSubmission" class="btn btn-danger">–ó–∞–∫—Ä–∏—Ç–∏ –ø–æ–¥–∞–Ω–Ω—è</button>
                    </div>
                </form>

                <!-- –ü–æ—Ç–æ—á–Ω–µ –ø–æ–¥–∞–Ω–Ω—è (–ø–µ—Ä–µ–≥–ª—è–¥) -->
                <div id="currentSubmission" class="current-submission hidden">
                    <h3>–ü–æ—Ç–æ—á–Ω–µ –ø–æ–¥–∞–Ω–Ω—è</h3>
                    <div id="submissionDisplay" class="submission-display"></div>
                </div>
            </div>
        </section>

        <!-- –°–µ–∫—Ü—ñ—è: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–≤—ñ—Ç—ñ–≤ -->
        <section id="generatorSection" class="page-section active">
        <form id="reportForm" class="report-form">
            <!-- –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤—ñ–¥–µ–æ -->
            <div class="form-group video-upload-section">
                <label for="videoFile">–î–æ–¥–∞—Ç–∏ –≤—ñ–¥–µ–æ (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                <div class="video-upload-wrapper">
                    <input type="file" id="videoFile" name="videoFile" accept="video/*" style="display: none;">
                    <button type="button" id="videoUploadBtn" class="btn btn-outline">
                        <span>üìπ –í–∏–±—Ä–∞—Ç–∏ –≤—ñ–¥–µ–æ</span>
                    </button>
                    <span id="videoFileName" class="video-file-name"></span>
                    <button type="button" id="removeVideoBtn" class="btn btn-outline btn-small" style="display: none;">‚úï</button>
                </div>
                <small class="form-hint">–í—ñ–¥–µ–æ –±—É–¥–µ –¥–æ–¥–∞–Ω–æ –¥–æ –∑–≤—ñ—Ç—É –ø—Ä–∏ –ø–æ–¥—ñ–ª–∏—Ç–∏—Å—è</small>
            </div>

            <div class="form-group">
                <label for="subdivision">–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª:</label>
                <select id="subdivision" name="subdivision" required onchange="toggleCustomSubdivision()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customSubdivision" name="customSubdivision" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customSubdivision')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="jointWith">–°—É–º—ñ—Å–Ω–æ –∑:</label>
                <select id="jointWith" name="jointWith" onchange="toggleCustomJointWith()">
                    <option value="">‚Äî</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customJointWith" name="customJointWith" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customJointWith')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <!-- –î—Ä–æ–Ω: –Ω–∞–∑–≤–∞, —Ä–æ–∑–º—ñ—Ä —ñ —Ç–∏–ø –∫–∞–º–µ—Ä–∏ –≤ –æ–¥–Ω–æ–º—É —Ä—è–¥–∫—É -->
            <div class="form-row">
                <div class="form-group">
                    <label for="droneName">–ù–∞–∑–≤–∞ –¥—Ä–æ–Ω—É:</label>
                    <select id="droneName" name="droneName" required onchange="autoFillReportDroneFields()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å –Ω–∞–∑–≤—É –¥—Ä–æ–Ω—É...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥–∞–Ω–Ω—è -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customDroneName" name="customDroneName" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –¥—Ä–æ–Ω—É..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customDroneName')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="cameraType">–¢–∏–ø:</label>
                    <select id="cameraType" name="cameraType" required onchange="toggleCustomCameraType()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customCameraType" name="customCameraType" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–∏–ø..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customCameraType')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∞–Ω –¥—Ä–æ–Ω–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑ –ø–æ–¥–∞–Ω–Ω—è) -->
            <div class="form-group">
                <label>–°—Ç–∞–Ω –¥—Ä–æ–Ω–∞:</label>
                <div id="droneStatusDisplay" style="padding: 12px; background: #f7fafc; border: 2px solid #e2e8f0; border-radius: 8px; color: #2d3748;">
                    <span id="droneStatusText">–û–±–µ—Ä—ñ—Ç—å –¥—Ä–æ–Ω –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É</span>
                </div>
            </div>

            <!-- –û–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ (—è–∫—â–æ —î –≤ –ø–æ–¥–∞–Ω–Ω—ñ) -->
            <div class="form-group" id="fiberOpticGroup" style="display: none;">
                <label>–û–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–æ:</label>
                <input type="text" id="fiberOpticLength" name="fiberOpticLength" class="form-control" readonly>
            </div>

            <!-- –ß–∞—Å—Ç–æ—Ç–∏: –≤—ñ–¥–µ–æ —ñ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤ –æ–¥–Ω–æ–º—É —Ä—è–¥–∫—É -->
            <div class="form-row" id="frequencyRow">
                <div class="form-group">
                    <label for="videoFrequency">–ß–∞—Å—Ç–æ—Ç–∞ –≤—ñ–¥–µ–æ:</label>
                    <select id="videoFrequency" name="videoFrequency" required onchange="toggleCustomVideoFrequency()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å—Ç–æ—Ç—É –≤—ñ–¥–µ–æ...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customVideoFrequency" name="customVideoFrequency" placeholder="–í–≤–µ–¥—ñ—Ç—å —á–∞—Å—Ç–æ—Ç—É –≤—ñ–¥–µ–æ..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customVideoFrequency')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="channel">–ö–∞–Ω–∞–ª (—á–µ—Ä–µ–∑ –∫–æ–º—É):</label>
                    <div class="custom-input-wrapper" style="display: block;">
                        <input type="text" id="channel" name="channel" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: R1, R2, F1..." list="channelList" data-save-option="true" autocomplete="off">
                        <button type="button" class="save-option-btn active" onclick="toggleSaveOption('channel')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                    <datalist id="channelList"></datalist>
                </div>

                <div class="form-group">
                    <label for="controlFrequency">–ß–∞—Å—Ç–æ—Ç–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è:</label>
                    <select id="controlFrequency" name="controlFrequency" required onchange="toggleCustomControlFrequency()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å—Ç–æ—Ç—É –∫–µ—Ä—É–≤–∞–Ω–Ω—è...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customControlFrequency" name="customControlFrequency" placeholder="–í–≤–µ–¥—ñ—Ç—å —á–∞—Å—Ç–æ—Ç—É –∫–µ—Ä—É–≤–∞–Ω–Ω—è..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customControlFrequency')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- –î–æ–≤–∂–∏–Ω–∞ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–∞ (–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–ª—è –æ–ø—Ç–æ–≤–æ–ª–æ–∫–æ–Ω–Ω–∏—Ö –¥—Ä–æ–Ω—ñ–≤) -->
            <div class="form-group" id="fiberOpticGroup" style="display: none;">
                <label for="fiberOpticLength">–î–æ–≤–∂–∏–Ω–∞ –æ–ø—Ç–æ–≤–æ–ª–æ–∫–Ω–∞:</label>
                <input type="text" id="fiberOpticLength" name="fiberOpticLength" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 10 –∫–º">
            </div>

            <!-- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–ª—è -->
            <div class="form-group">
                <label for="bk">–ë–ö:</label>
                <select id="bk" name="bk" onchange="toggleCustomBk()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –ë–ö...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customBk" name="customBk" placeholder="–í–≤–µ–¥—ñ—Ç—å –ë–ö..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customBk')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="initiationBoard">–ü–ª–∞—Ç–∞ –Ü–Ω—ñ—Ü—ñ–∞—Ü—ñ—ó:</label>
                <select id="initiationBoard" name="initiationBoard" onchange="toggleCustomInitiationBoard()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –ø–ª–∞—Ç—É...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customInitiationBoard" name="customInitiationBoard" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–ª–∞—Ç—É..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customInitiationBoard')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <!-- –¶—ñ–ª—å —Ä–æ–∑–¥—ñ–ª–µ–Ω–∞ –Ω–∞ —Ç—Ä–∏ –ø–æ–ª—è –≤ –æ–¥–Ω–æ–º—É —Ä—è–¥–∫—É -->
            <div class="form-row">
                <div class="form-group">
                    <label for="targetType">–¢–∏–ø —Ü—ñ–ª—ñ:</label>
                    <select id="targetType" name="targetType" onchange="toggleCustomTargetType()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ü—ñ–ª—ñ...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customTargetType" name="customTargetType" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–∏–ø —Ü—ñ–ª—ñ..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customTargetType')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="settlement">–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç:</label>
                    <select id="settlement" name="settlement" onchange="toggleCustomSettlement()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customSettlement" name="customSettlement" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customSettlement')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <div class="form-group" id="coordinatesGroup">
                    <label for="coordinates">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:<span id="coordinatesRequired" style="color: red; display: none;"> *</span></label>
                    <input type="text" id="coordinates" name="coordinates" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 50.4501, 30.5234" maxlength="50">
                </div>
            </div>

            <div class="form-group">
                <label for="status">–°—Ç–∞—Ç—É—Å:</label>
                <select id="status" name="status" onchange="toggleCustomStatus(); toggleReasonField()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å —Å—Ç–∞—Ç—É—Å...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customStatus" name="customStatus" placeholder="–í–≤–µ–¥—ñ—Ç—å —Å—Ç–∞—Ç—É—Å..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customStatus')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <div class="form-group" id="reasonGroup" style="display: none;">
                <label for="reason">–ü—Ä–∏—á–∏–Ω–∞:</label>
                <select id="reason" name="reason" onchange="toggleCustomReason()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customReason" name="customReason" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customReason')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="losses">–í—Ç—Ä–∞—Ç–∏:</label>
                <select id="losses" name="losses" onchange="toggleCustomLosses()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –≤—Ç—Ä–∞—Ç–∏...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customLosses" name="customLosses" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–∏–ø –≤—Ç—Ä–∞—Ç..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customLosses')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="operator">–û–ø–µ—Ä–∞—Ç–æ—Ä:</label>
                <select id="operator" name="operator" onchange="toggleCustomOperator()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customOperator" name="customOperator" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customOperator')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <!-- –ß–µ–∫–±–æ–∫—Å —Å—Ç—Ä—ñ–º -->
            <div class="form-group">
                <label>
                    <input type="checkbox" id="stream" name="stream">
                    –°—Ç—Ä—ñ–º
                </label>
            </div>

            <div class="form-group">
                <label for="date">–î–∞—Ç–∞:</label>
                <input type="date" id="date" name="date" required title="–û–±–µ—Ä—ñ—Ç—å —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É –∞–±–æ –¥–∞—Ç—É –∑ –º–∏–Ω—É–ª–æ–≥–æ">
                <small style="color: #666; font-size: 0.85rem; margin-top: 4px; display: block;">
                    üí° –î–æ–∑–≤–æ–ª–µ–Ω–æ: —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—è –¥–∞—Ç–∞ —Ç–∞ –º–∏–Ω—É–ª—ñ –¥–∞—Ç–∏
                </small>
            </div>

            <div class="form-group">
                <label for="time">–ß–∞—Å:</label>
                <input type="time" id="time" name="time" required>
            </div>

            <!-- –ü–æ–ª–µ '–¢–∏–ø –º—ñ—Å—ñ—ó' –≤–∏–¥–∞–ª–µ–Ω–æ -->

            <div class="form-group">
                <label for="mission">–û–ø–∏—Å –º—ñ—Å—ñ—ó (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                <textarea id="mission" name="mission" rows="4" placeholder="–û–ø–∏—à—ñ—Ç—å –¥–µ—Ç–∞–ª—ñ –º—ñ—Å—ñ—ó –∞–±–æ –¥–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é..."></textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">–ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç</button>
                <button type="reset" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É</button>
            </div>
        </form>

        <div id="reportOutput" class="report-output hidden">
            <h2>–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∑–≤—ñ—Ç</h2>
            <div id="reportContent" class="report-content"></div>
            <div class="report-actions">
                <button id="shareReport" class="btn btn-outline">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</button>
                <button id="downloadReport" class="btn btn-outline">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–≤—ñ—Ç</button>
                <button id="newReportBasedOn" class="btn btn-secondary">–ù–æ–≤–∏–π –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ</button>
                <button id="newReport" class="btn btn-primary">–ù–æ–≤–∏–π –∑–≤—ñ—Ç</button>
            </div>
        </div>
        </section>
        <!-- –ö—ñ–Ω–µ—Ü—å —Å–µ–∫—Ü—ñ—ó –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ -->

        <!-- –°–µ–∫—Ü—ñ—è: –ê—Ä—Ö—ñ–≤ –∑–≤—ñ—Ç—ñ–≤ -->
        <section id="archiveSection" class="page-section">
            <h2>–ê—Ä—Ö—ñ–≤</h2>
            
            <!-- –ê—Ä—Ö—ñ–≤–Ω—ñ –ø–æ–¥–∞–Ω–Ω—è -->
            <div id="archivedSubmissions" class="archived-submissions">
                <h3>–ê—Ä—Ö—ñ–≤–Ω—ñ –ø–æ–¥–∞–Ω–Ω—è</h3>
                <div class="history-controls">
                    <button id="refreshArchivedSubmissions" class="btn btn-outline">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
                </div>
                <div id="archivedSubmissionsList" class="archived-submissions-list">
                    <!-- –°–ø–∏—Å–æ–∫ –∞—Ä—Ö—ñ–≤–Ω–∏—Ö –ø–æ–¥–∞–Ω—å –±—É–¥–µ —Ç—É—Ç -->
                </div>
            </div>
            
            <hr style="margin: 2rem 0;">
            
            <!-- –ó–≤—ñ—Ç–∏ -->
            <div id="reportsHistory" class="reports-history">
                <h3>–ó–≤—ñ—Ç–∏</h3>
                <div class="history-controls">
                    <button id="refreshHistory" class="btn btn-outline">üîÑ –û–Ω–æ–≤–∏—Ç–∏</button>
                </div>
                <div id="historyContent" class="history-content">
                    <div class="history-filters">
                        <input type="text" id="searchReports" placeholder="–ü–æ—à—É–∫ –∑–∞ –Ω–æ–º–µ—Ä–æ–º –∑–≤—ñ—Ç—É, –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–æ–º..." class="search-input">
                        <select id="filterBySubdivision" class="filter-select">
                            <option value="">–í—Å—ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∏</option>
                        </select>
                    </div>
                    <div id="reportsList" class="reports-list">
                        <!-- –°–ø–∏—Å–æ–∫ –∑–≤—ñ—Ç—ñ–≤ –±—É–¥–µ —Ç—É—Ç -->
                    </div>
                    <div class="pagination">
                        <button id="prevPage" class="btn btn-outline">‚Üê –ü–æ–ø–µ—Ä–µ–¥–Ω—è</button>
                        <span id="pageInfo">–°—Ç–æ—Ä—ñ–Ω–∫–∞ 1</span>
                        <button id="nextPage" class="btn btn-outline">–ù–∞—Å—Ç—É–ø–Ω–∞ ‚Üí</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- –°–µ–∫—Ü—ñ—è: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -->
        <section id="settingsSection" class="page-section">
            <h2>–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
            <div class="settings-content">
                <div class="settings-group">
                    <h3>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫—ñ –æ–ø—Ü—ñ—ó</h3>
                    <p>–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∫–µ—Ä—É–≤–∞—Ç–∏ –≤–∞—à–∏–º–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–∏–º–∏ –æ–ø—Ü—ñ—è–º–∏ –¥–ª—è –≤—Å—ñ—Ö –ø–æ–ª—ñ–≤ —Ñ–æ—Ä–º–∏.</p>
                    <div id="customOptionsManager">
                        <!-- –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö –æ–ø—Ü—ñ–π –±—É–¥–µ —Ç—É—Ç -->
                        <p class="info-message">üí° –©–æ–± –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ –æ–ø—Ü—ñ—ó, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–Ω–æ–ø–∫—É üíæ –≤ –ø–æ–ª—è—Ö —Ñ–æ—Ä–º–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∑–≤—ñ—Ç—ñ–≤.</p>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h3>–ü—Ä–æ –¥–æ–¥–∞—Ç–æ–∫</h3>
                    <p><strong>–í–µ—Ä—Å—ñ—è:</strong> 2.0.1</p>
                    <p><strong>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:</strong> <span id="settingsUserEmail"></span></p>
                </div>
            </div>
        </section>
    </div>

    <script src="supabase-functions.js"></script>
    <script src="auth.js"></script>
    <script src="multiselect.js"></script>
    <script src="script.js"></script>
    <script src="reports-history.js"></script>
    <script src="submission.js"></script>
    <script>
        // toggleModifications –±—ñ–ª—å—à–µ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ - —Å—Ç–∞—Ç—É—Å –±–µ—Ä–µ—Ç—å—Å—è –∑ –ø–æ–¥–∞–Ω–Ω—è
        

    </script>
    
    <script>
        // ============================================
        // –ê–í–¢–û–ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø –§–û–†–ú–ò –í LOCALSTORAGE
        // ============================================
        
        const FORM_SAVE_KEY = 'droneReportFormData';
        const FORM_SAVE_INTERVAL = 30000; // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥ (–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è –µ–Ω–µ—Ä–≥–æ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ)
        
        // –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –ø–æ–ª—è —Ñ–æ—Ä–º–∏
        function getFormFields() {
            const form = document.getElementById('reportForm');
            if (!form) return [];
            
            return Array.from(form.querySelectorAll('input, select, textarea')).filter(field => {
                // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø–æ–ª—è –ø–∞—Ä–æ–ª—è —Ç–∞ —ñ–Ω—à—ñ —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ
                return field.type !== 'password' && field.id !== 'loginPassword' && field.id !== 'registerPassword';
            });
        }
        
        // –ó–±–µ—Ä–µ–≥—Ç–∏ —Å—Ç–∞–Ω —Ñ–æ—Ä–º–∏
        function saveFormState() {
            try {
                const fields = getFormFields();
                if (fields.length === 0) {
                    console.warn('[AutoSave] –ù–µ–º–∞—î –ø–æ–ª—ñ–≤ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è');
                    return;
                }
                
                const formData = {};
                let savedCount = 0;
                
                fields.forEach(field => {
                    if (field.type === 'checkbox') {
                        formData[field.id] = field.checked;
                        savedCount++;
                    } else if (field.type === 'radio') {
                        if (field.checked) {
                            formData[field.name] = field.value;
                            savedCount++;
                        }
                    } else if (field.value && field.value.trim() !== '') {
                        formData[field.id] = field.value;
                        savedCount++;
                    }
                });
                
                if (savedCount > 0) {
                    localStorage.setItem(FORM_SAVE_KEY, JSON.stringify(formData));
                    console.log(`[AutoSave] –§–æ—Ä–º—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ (${savedCount} –ø–æ–ª—ñ–≤)`);
                }
            } catch (error) {
                console.error('[AutoSave] –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', error);
            }
        }
        
        // –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞–Ω —Ñ–æ—Ä–º–∏
        function restoreFormState() {
            try {
                const savedData = localStorage.getItem(FORM_SAVE_KEY);
                if (!savedData) {
                    console.log('[AutoSave] –ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è');
                    return;
                }
                
                const formData = JSON.parse(savedData);
                const fields = getFormFields();
                
                if (fields.length === 0) {
                    console.warn('[AutoSave] –ü–æ–ª—è —Ñ–æ—Ä–º–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è');
                    return;
                }
                
                let restoredCount = 0;
                
                fields.forEach(field => {
                    const savedValue = formData[field.id] || formData[field.name];
                    
                    if (savedValue !== undefined && savedValue !== null) {
                        if (field.type === 'checkbox') {
                            field.checked = savedValue;
                            restoredCount++;
                            // –í–∏–∫–ª–∏–∫–∞—Ç–∏ onChange –¥–ª—è —á–µ–∫–±–æ–∫—Å—ñ–≤ (–¥–ª—è toggleFiberLength —Ç–∞ —ñ–Ω—à–∏—Ö)
                            if (field.onchange) {
                                try {
                                    field.onchange();
                                } catch (e) {
                                    console.warn('[AutoSave] –ü–æ–º–∏–ª–∫–∞ –≤–∏–∫–ª–∏–∫—É onchange –¥–ª—è', field.id, e);
                                }
                            }
                        } else if (field.type === 'radio') {
                            if (field.value === savedValue) {
                                field.checked = true;
                                restoredCount++;
                            }
                        } else {
                            field.value = savedValue;
                            restoredCount++;
                            // –í–∏–∫–ª–∏–∫–∞—Ç–∏ onChange –¥–ª—è —Å–µ–ª–µ–∫—Ç—ñ–≤ (–¥–ª—è toggleCustom —Ñ—É–Ω–∫—Ü—ñ–π)
                            if (field.onchange) {
                                try {
                                    field.onchange();
                                } catch (e) {
                                    console.warn('[AutoSave] –ü–æ–º–∏–ª–∫–∞ –≤–∏–∫–ª–∏–∫—É onchange –¥–ª—è', field.id, e);
                                }
                            }
                        }
                    }
                });
                
                console.log(`[AutoSave] –§–æ—Ä–º—É –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ (${restoredCount} –ø–æ–ª—ñ–≤)`);
            } catch (error) {
                console.error('[AutoSave] –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è:', error);
            }
        }
        
        // –û—á–∏—Å—Ç–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–≤—ñ—Ç—É
        function clearSavedFormState() {
            try {
                localStorage.removeItem(FORM_SAVE_KEY);
                console.log('[AutoSave] –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ');
            } catch (error) {
                console.error('[AutoSave] –ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è:', error);
            }
        }
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è (–≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –ª–æ–≥—ñ–Ω–∞)
        window.initAutoSave = function() {
            console.log('[AutoSave] –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è');
            
            // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ –≤–≤–µ–¥–µ–Ω–Ω—ñ
            const fields = getFormFields();
            if (fields.length === 0) {
                console.warn('[AutoSave] –ü–æ–ª—è —Ñ–æ—Ä–º–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                return;
            }
            
            console.log('[AutoSave] –ó–Ω–∞–π–¥–µ–Ω–æ –ø–æ–ª—ñ–≤:', fields.length);
            
            fields.forEach(field => {
                field.addEventListener('input', () => {
                    saveFormState();
                }, { once: false });
                field.addEventListener('change', () => {
                    saveFormState();
                }, { once: false });
            });
            
            // –î–æ–¥–∞—Ç–∫–æ–≤–µ –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ N —Å–µ–∫—É–Ω–¥ (—Ä—ñ–¥—à–µ, —Ç–æ–º—É —â–æ —î –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ input/change)
            // –¶–µ –ª–∏—à–µ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –Ω–∞ –≤–∏–ø–∞–¥–æ–∫ —è–∫—â–æ –ø–æ–¥—ñ—ó –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∏
            const saveInterval = setInterval(saveFormState, FORM_SAVE_INTERVAL);
            
            // –û—á–∏—â–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ
            window.addEventListener('beforeunload', () => {
                clearInterval(saveInterval);
            });
            
            // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ –∑–≥–æ—Ä—Ç–∞–Ω–Ω—ñ –¥–æ–¥–∞—Ç–∫—É
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    saveFormState();
                    console.log('[AutoSave] –î–æ–¥–∞—Ç–æ–∫ –∑–≥–æ—Ä–Ω—É—Ç–æ - —Ñ–æ—Ä–º—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ');
                }
            });
            
            // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏—Ç—Ç—è–º
            window.addEventListener('beforeunload', () => {
                saveFormState();
            });
            
            console.log('[AutoSave] –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ');
        };
        
        // –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —ñ–Ω—à–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö
        window.saveFormState = saveFormState;
        window.restoreFormState = restoreFormState;
        window.clearSavedFormState = clearSavedFormState;
    </script>
    
    <script>
        // ============================================
        // SERVICE WORKER –ó –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ò–ú –û–ù–û–í–õ–ï–ù–ù–Ø–ú
        // ============================================
        
        if ('serviceWorker' in navigator) {
            let newWorkerWaiting = null;
            
            // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤–µ—Ä—Å—ñ—é
            async function loadVersionInfo() {
                try {
                    const response = await fetch('./version-info.json?' + Date.now());
                    if (!response.ok) throw new Error('Failed to load version info');
                    return await response.json();
                } catch (error) {
                    console.warn('[App] –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ version-info.json:', error);
                    return {
                        version: '?',
                        changes: ['–ù–æ–≤–∞ –≤–µ—Ä—Å—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞!']
                    };
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
            async function showUpdateNotification() {
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤–µ—Ä—Å—ñ—é
                const versionInfo = await loadVersionInfo();
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ —Å—Ç–∏–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 20px 25px;
                    border-radius: 12px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    z-index: 10000;
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                    animation: slideDown 0.3s ease-out;
                    max-width: 400px;
                    width: 90%;
                `;
                
                // –§–æ—Ä–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ –∑–º—ñ–Ω
                const changesList = versionInfo.changes
                    .map(change => `<div style="margin: 5px 0; font-size: 13px;">‚ñ™ ${change}</div>`)
                    .join('');
                
                notification.innerHTML = `
                    <div style="margin-bottom: 12px;">
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">
                            üéâ –ù–æ–≤–∞ –≤–µ—Ä—Å—ñ—è v${versionInfo.version}
                        </div>
                        <div style="font-size: 14px; opacity: 0.95; margin-bottom: 8px;">
                            –©–æ –Ω–æ–≤–æ–≥–æ:
                        </div>
                        <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px; margin-bottom: 12px;">
                            ${changesList}
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button id="updateBtn" style="
                            background: white;
                            color: #667eea;
                            border: none;
                            padding: 10px 25px;
                            border-radius: 6px;
                            font-weight: bold;
                            cursor: pointer;
                            font-size: 14px;
                            flex: 1;
                            max-width: 150px;
                        ">–û–Ω–æ–≤–∏—Ç–∏</button>
                        <button id="dismissBtn" style="
                            background: transparent;
                            color: white;
                            border: 1px solid white;
                            padding: 10px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-size: 14px;
                        ">–ü—ñ–∑–Ω—ñ—à–µ</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                document.getElementById('updateBtn').addEventListener('click', () => {
                    if (newWorkerWaiting) {
                        newWorkerWaiting.postMessage({ type: 'SKIP_WAITING' });
                    }
                    notification.remove();
                });
                
                document.getElementById('dismissBtn').addEventListener('click', () => {
                    notification.remove();
                });
                
                console.log('[App] üéâ –ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è v' + versionInfo.version);
            }
            
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('[App] ‚úÖ Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ');
                        
                        // –ï–Ω–µ—Ä–≥–æ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å
                        let lastUpdateCheck = Date.now();
                        const MIN_UPDATE_INTERVAL = 5 * 60 * 1000; // –ú—ñ–Ω—ñ–º—É–º 5 —Ö–≤–∏–ª–∏–Ω –º—ñ–∂ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞–º–∏
                        
                        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—ñ –¥–æ –≤–∫–ª–∞–¥–∫–∏ (–Ω–µ —á–∞—Å—Ç—ñ—à–µ –Ω—ñ–∂ —Ä–∞–∑ –Ω–∞ 5 —Ö–≤)
                        document.addEventListener('visibilitychange', () => {
                            if (!document.hidden && (Date.now() - lastUpdateCheck) > MIN_UPDATE_INTERVAL) {
                                console.log('[App] üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å (–≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞)');
                                registration.update();
                                lastUpdateCheck = Date.now();
                            }
                        });
                        
                        // –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ (–∫–æ–∂–Ω—ñ 10 —Ö–≤–∏–ª–∏–Ω)
                        const updateInterval = setInterval(() => {
                            if (!document.hidden) {
                                console.log('[App] üîç –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å');
                                registration.update();
                            }
                        }, 10 * 60 * 1000); // 10 —Ö–≤–∏–ª–∏–Ω
                        
                        // –û—á–∏—â–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ
                        window.addEventListener('beforeunload', () => {
                            clearInterval(updateInterval);
                        });
                        
                        // –í—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('[App] üì• –ó–Ω–∞–π–¥–µ–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...');
                            
                            newWorkerWaiting = newWorker;
                            
                            newWorker.addEventListener('statechange', () => {
                                console.log('[App] SW State:', newWorker.state);
                                
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // –ù–æ–≤–∏–π Service Worker –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                                    console.log('[App] ‚ú® –ù–æ–≤–∞ –≤–µ—Ä—Å—ñ—è –≥–æ—Ç–æ–≤–∞!');
                                    showUpdateNotification();
                                }
                            });
                        });
                        
                        // –Ø–∫—â–æ —î Service Worker, —â–æ —á–µ–∫–∞—î
                        if (registration.waiting) {
                            newWorkerWaiting = registration.waiting;
                            showUpdateNotification();
                        }
                        
                        // –û–¥—Ä–∞–∑—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
                        registration.update();
                    })
                    .catch(error => {
                        console.error('[App] ‚ùå –ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó Service Worker:', error);
                    });
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞
                let refreshing = false;
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (!refreshing) {
                        refreshing = true;
                        console.log('[App] üîÑ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É...');
                        window.location.reload();
                    }
                });
                
                // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ Service Worker
                navigator.serviceWorker.addEventListener('message', event => {
                    if (event.data && event.data.type === 'RELOAD_PAGE') {
                        window.location.reload();
                    }
                });
            });
            
            // CSS –∞–Ω—ñ–º–∞—Ü—ñ—è –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from {
                        transform: translate(-50%, -100px);
                        opacity: 0;
                    }
                    to {
                        transform: translate(-50%, 0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
        }
    </script>
    </div> <!-- End of appSection -->
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –∞—Ä—Ö—ñ–≤–Ω–æ–≥–æ –ø–æ–¥–∞–Ω–Ω—è -->
    <div id="archivedSubmissionModal" class="modal-overlay" style="display: none;" onclick="if(event.target === this) closeArchivedSubmissionModal()">
        <div class="modal-content archived-submission-modal">
            <div class="modal-header">
                <h2 id="modalSubmissionTitle">–ü–æ–¥–∞–Ω–Ω—è</h2>
                <button class="modal-close" onclick="closeArchivedSubmissionModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="modalSubmissionDetails" class="submission-details">
                    <!-- –î–µ—Ç–∞–ª—ñ –ø–æ–¥–∞–Ω–Ω—è -->
                </div>
                <div id="modalSubmissionReports" class="submission-reports">
                    <h3>–ó–≤—ñ—Ç–∏ —Ü—å–æ–≥–æ –ø–æ–¥–∞–Ω–Ω—è</h3>
                    <div id="modalReportsList">
                        <!-- –°–ø–∏—Å–æ–∫ –∑–≤—ñ—Ç—ñ–≤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>