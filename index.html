<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–≤—ñ—Ç—ñ–≤ –ø—Ä–æ –¥—Ä–æ–Ω–∏</title>
    <meta name="description" content="–ó–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–≤—ñ—Ç—ñ–≤ –ø—Ä–æ –¥—Ä–æ–Ω–∏">
    <meta name="theme-color" content="#4facfe">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –ª–æ–≥—ñ–Ω–∞/—Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
    <div id="authSection" class="auth-section">
        <div class="auth-container">
            <h1>üöÅ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–≤—ñ—Ç—ñ–≤ –ø—Ä–æ –¥—Ä–æ–Ω–∏</h1>
            
            <!-- –§–æ—Ä–º–∞ –ª–æ–≥—ñ–Ω–∞ -->
            <div id="loginForm" class="auth-form">
                <h2>–í—Ö—ñ–¥</h2>
                <form id="loginFormElement">
                    <div class="form-group">
                        <label for="loginUsername">–õ–æ–≥—ñ–Ω:</label>
                        <input type="text" id="loginUsername" required placeholder="–í–∞—à –ª–æ–≥—ñ–Ω">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="submit" class="btn btn-primary">–£–≤—ñ–π—Ç–∏</button>
                    <!-- –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –≤–∏–º–∫–Ω–µ–Ω–∞ - –∞–∫–∞—É–Ω—Ç–∏ –¥–æ–¥–∞—é—Ç—å—Å—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º -->
                    <!-- <p class="auth-switch">–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É? <a href="#" id="showRegister">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</a></p> -->
                </form>
            </div>

            <!-- –§–æ—Ä–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –≤–∏–º–∫–Ω–µ–Ω–∞ - –∞–∫–∞—É–Ω—Ç–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —á–µ—Ä–µ–∑ –ë–î -->
            <!-- 
            <div id="registerForm" class="auth-form" style="display: none;">
                <h2>–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
                <form id="registerFormElement">
                    <div class="form-group">
                        <label for="registerUsername">–õ–æ–≥—ñ–Ω:</label>
                        <input type="text" id="registerUsername" required placeholder="–í–∞—à –ª–æ–≥—ñ–Ω" pattern="[a-zA-Z0-9_-]{3,20}" title="3-20 —Å–∏–º–≤–æ–ª—ñ–≤: –ª—ñ—Ç–µ—Ä–∏, —Ü–∏—Ñ—Ä–∏, _ –∞–±–æ -">
                    </div>
                    <div class="form-group">
                        <label for="registerName">–Ü–º'—è (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                        <input type="text" id="registerName" placeholder="–í–∞—à–µ —ñ–º'—è">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="registerPassword" required placeholder="–ú—ñ–Ω—ñ–º—É–º 6 —Å–∏–º–≤–æ–ª—ñ–≤">
                    </div>
                    <div class="form-group">
                        <label for="registerPasswordConfirm">–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="registerPasswordConfirm" required placeholder="–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –ø–∞—Ä–æ–ª—å">
                    </div>
                    <button type="submit" class="btn btn-primary">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
                    <p class="auth-switch">–í–∂–µ —î –∞–∫–∞—É–Ω—Ç? <a href="#" id="showLogin">–£–≤—ñ–π—Ç–∏</a></p>
                </form>
            </div>
            -->
        </div>
    </div>

    <!-- –ì–æ–ª–æ–≤–Ω–∏–π –¥–æ–¥–∞—Ç–æ–∫ (–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –ª–æ–≥—ñ–Ω–∞) -->
    <div id="appSection" class="container" style="display: none;">
        <header>
            <div class="header-content">
                <div>
                    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–≤—ñ—Ç—ñ–≤ –ø—Ä–æ –¥—Ä–æ–Ω–∏</h1>
                    <p>–ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—ñ—Ç—É</p>
                </div>
                <div class="user-info">
                    <span id="userEmailDisplay"></span>
                    <button id="logoutBtn" class="btn btn-outline btn-small">–í–∏–π—Ç–∏</button>
                </div>
            </div>
            <!-- –ü–µ—Ä–µ–º–∏–∫–∞—á —Ä–æ–∑—à–∏—Ä–µ–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É -->
            <div class="advanced-mode-toggle">
                <label class="switch-label">
                    <input type="checkbox" id="advancedModeSwitch">
                    <span class="switch-slider"></span>
                    <span class="switch-text" title="–£–≤—ñ–º–∫–Ω—ñ—Ç—å —â–æ–± –≤–∏–¥–∞–ª—è—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –æ–ø—Ü—ñ—ó –∑ üë§üóëÔ∏è. –ü—Ä–æ—Å—Ç–æ –≤–∏–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é –∑ –∫–æ—Ä–∑–∏–Ω–æ—é –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è.">–†–æ–∑—à–∏—Ä–µ–Ω—ñ</span>
                </label>
            </div>
        </header>

        <form id="reportForm" class="report-form">
            <div class="form-group">
                <label for="subdivision">–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª:</label>
                <select id="subdivision" name="subdivision" required onchange="toggleCustomSubdivision()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customSubdivision" name="customSubdivision" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customSubdivision')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="jointWith">–°—É–º—ñ—Å–Ω–æ –∑:</label>
                <select id="jointWith" name="jointWith" onchange="toggleCustomJointWith()">
                    <option value="">‚Äî</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customJointWith" name="customJointWith" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customJointWith')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <!-- –î—Ä–æ–Ω: –Ω–∞–∑–≤–∞, —Ä–æ–∑–º—ñ—Ä —ñ —Ç–∏–ø –∫–∞–º–µ—Ä–∏ –≤ –æ–¥–Ω–æ–º—É —Ä—è–¥–∫—É -->
            <div class="form-row">
                <div class="form-group">
                    <label for="droneName">–ù–∞–∑–≤–∞ –¥—Ä–æ–Ω—É:</label>
                    <select id="droneName" name="droneName" required onchange="toggleCustomDroneName()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å –Ω–∞–∑–≤—É –¥—Ä–æ–Ω—É...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customDroneName" name="customDroneName" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –¥—Ä–æ–Ω—É..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customDroneName')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="droneSize">–†–æ–∑–º—ñ—Ä –¥—Ä–æ–Ω—É:</label>
                    <select id="droneSize" name="droneSize" required onchange="toggleCustomDroneSize()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —Ä–æ–∑–º—ñ—Ä –¥—Ä–æ–Ω—É...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customDroneSize" name="customDroneSize" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ä–æ–∑–º—ñ—Ä –¥—Ä–æ–Ω—É..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customDroneSize')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="cameraType">–¢–∏–ø –∫–∞–º–µ—Ä–∏:</label>
                    <select id="cameraType" name="cameraType" required onchange="toggleCustomCameraType()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –∫–∞–º–µ—Ä–∏...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customCameraType" name="customCameraType" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–∏–ø –∫–∞–º–µ—Ä–∏..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customCameraType')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- –ó–∞–≤–æ–¥—Å—å–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è -->
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="factoryConfig" name="factoryConfig" onchange="toggleModifications()" checked style="width: auto; margin: 0;">
                    <span>–ó–∞–≤–æ–¥—Å—å–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è</span>
                </label>
            </div>

            <!-- –ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (–ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –∫–æ–ª–∏ –∑–∞–≤–æ–¥—Å—å–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è –≤–∏–º–∫–Ω–µ–Ω–∞) -->
                        <div class="form-group" id="modificationsGroup" style="display: none;">
                <label for="modifications">–ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó (—á–µ—Ä–µ–∑ –∫–æ–º—É):</label>
                <div class="custom-input-wrapper" style="display: block;">
                    <input type="text" id="modifications" list="modificationsList" data-save-option="true">
                    <button onclick="toggleSaveOption('modifications')" class="active">üíæ</button>
                </div>
                <datalist id="modificationsList"></datalist>
            </div>

            <!-- –ß–∞—Å—Ç–æ—Ç–∏: –≤—ñ–¥–µ–æ —ñ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –≤ –æ–¥–Ω–æ–º—É —Ä—è–¥–∫—É -->
            <div class="form-row" id="frequencyRow">
                <div class="form-group">
                    <label for="videoFrequency">–ß–∞—Å—Ç–æ—Ç–∞ –≤—ñ–¥–µ–æ:</label>
                    <select id="videoFrequency" name="videoFrequency" required onchange="toggleCustomVideoFrequency()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å—Ç–æ—Ç—É –≤—ñ–¥–µ–æ...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customVideoFrequency" name="customVideoFrequency" placeholder="–í–≤–µ–¥—ñ—Ç—å —á–∞—Å—Ç–æ—Ç—É –≤—ñ–¥–µ–æ..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customVideoFrequency')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="channel">–ö–∞–Ω–∞–ª (—á–µ—Ä–µ–∑ –∫–æ–º—É):</label>
                    <div class="custom-input-wrapper" style="display: block;">
                        <input type="text" id="channel" name="channel" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: R1, R2, F1..." list="channelList" data-save-option="true">
                        <button type="button" class="save-option-btn active" onclick="toggleSaveOption('channel')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                    <datalist id="channelList"></datalist>
                </div>

                <div class="form-group">
                    <label for="controlFrequency">–ß–∞—Å—Ç–æ—Ç–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è:</label>
                    <select id="controlFrequency" name="controlFrequency" required onchange="toggleCustomControlFrequency()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —á–∞—Å—Ç–æ—Ç—É –∫–µ—Ä—É–≤–∞–Ω–Ω—è...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customControlFrequency" name="customControlFrequency" placeholder="–í–≤–µ–¥—ñ—Ç—å —á–∞—Å—Ç–æ—Ç—É –∫–µ—Ä—É–≤–∞–Ω–Ω—è..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customControlFrequency')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- –û–ø—Ç–æ–≤–æ–ª–æ–∫–æ–Ω–Ω–∏–π –∫–∞–±–µ–ª—å -->
            <div class="form-group">
                <label>
                    <input type="checkbox" id="fiberOptic" name="fiberOptic" onchange="toggleFiberLength()">
                    –û–ø—Ç–æ–≤–æ–ª–æ–∫–æ–Ω–Ω–∏–π –∫–∞–±–µ–ª—å
                </label>
            </div>

            <div class="form-group" id="fiberLengthGroup" style="display: none;">
                <label for="fiberLength">–î–æ–≤–∂–∏–Ω–∞ –∫–æ—Ç—É—à–∫–∏ (–∫–º):</label>
                <input type="number" id="fiberLength" name="fiberLength" min="0.1" max="100" step="0.1" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 0.5">
                <small style="color: #666; font-size: 0.85rem; margin-top: 4px; display: block;">
                    üí° –í–∫–∞–∂—ñ—Ç—å –¥–æ–≤–∂–∏–Ω—É –≤ –∫—ñ–ª–æ–º–µ—Ç—Ä–∞—Ö
                </small>
            </div>

            <!-- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–ª—è -->
            <div class="form-group">
                <label for="bk">–ë–ö:</label>
                <select id="bk" name="bk" onchange="toggleCustomBk()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –ë–ö...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customBk" name="customBk" placeholder="–í–≤–µ–¥—ñ—Ç—å –ë–ö..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customBk')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="initiationBoard">–ü–ª–∞—Ç–∞ –Ü–Ω—ñ—Ü—ñ–∞—Ü—ñ—ó:</label>
                <select id="initiationBoard" name="initiationBoard" onchange="toggleCustomInitiationBoard()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –ø–ª–∞—Ç—É...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customInitiationBoard" name="customInitiationBoard" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø–ª–∞—Ç—É..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customInitiationBoard')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <!-- –¶—ñ–ª—å —Ä–æ–∑–¥—ñ–ª–µ–Ω–∞ –Ω–∞ —Ç—Ä–∏ –ø–æ–ª—è –≤ –æ–¥–Ω–æ–º—É —Ä—è–¥–∫—É -->
            <div class="form-row">
                <div class="form-group">
                    <label for="targetType">–¢–∏–ø —Ü—ñ–ª—ñ:</label>
                    <select id="targetType" name="targetType" onchange="toggleCustomTargetType()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ü—ñ–ª—ñ...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customTargetType" name="customTargetType" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–∏–ø —Ü—ñ–ª—ñ..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customTargetType')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="settlement">–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç:</label>
                    <select id="settlement" name="settlement" onchange="toggleCustomSettlement()">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç...</option>
                        <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                    </select>
                    <div class="custom-input-wrapper" style="display: none;">
                        <input type="text" id="customSettlement" name="customSettlement" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É..." data-save-option="false">
                        <button type="button" class="save-option-btn" onclick="toggleSaveOption('customSettlement')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                            <span class="save-icon">üíæ</span>
                        </button>
                    </div>
                </div>

                <div class="form-group" id="coordinatesGroup">
                    <label for="coordinates">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏:<span id="coordinatesRequired" style="color: red; display: none;"> *</span></label>
                    <input type="text" id="coordinates" name="coordinates" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 50.4501, 30.5234" maxlength="50">
                </div>
            </div>

            <div class="form-group">
                <label for="status">–°—Ç–∞—Ç—É—Å:</label>
                <select id="status" name="status" onchange="toggleCustomStatus(); toggleReasonField()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å —Å—Ç–∞—Ç—É—Å...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customStatus" name="customStatus" placeholder="–í–≤–µ–¥—ñ—Ç—å —Å—Ç–∞—Ç—É—Å..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customStatus')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <div class="form-group" id="reasonGroup" style="display: none;">
                <label for="reason">–ü—Ä–∏—á–∏–Ω–∞:</label>
                <select id="reason" name="reason" onchange="toggleCustomReason()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customReason" name="customReason" placeholder="–í–≤–µ–¥—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customReason')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="losses">–í—Ç—Ä–∞—Ç–∏:</label>
                <select id="losses" name="losses" onchange="toggleCustomLosses()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –≤—Ç—Ä–∞—Ç–∏...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customLosses" name="customLosses" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–∏–ø –≤—Ç—Ä–∞—Ç..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customLosses')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="operator">–û–ø–µ—Ä–∞—Ç–æ—Ä:</label>
                <select id="operator" name="operator" onchange="toggleCustomOperator()">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞...</option>
                    <!-- –û–ø—Ü—ñ—ó –∑–∞–ø–æ–≤–Ω—é—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑ data.json -->
                </select>
                <div class="custom-input-wrapper" style="display: none;">
                    <input type="text" id="customOperator" name="customOperator" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞..." data-save-option="false">
                    <button type="button" class="save-option-btn" onclick="toggleSaveOption('customOperator')" title="–ó–±–µ—Ä–µ–≥—Ç–∏ –≤ –º–æ—ó –æ–ø—Ü—ñ—ó">
                        <span class="save-icon">üíæ</span>
                    </button>
                </div>
            </div>

            <!-- –ß–µ–∫–±–æ–∫—Å —Å—Ç—Ä—ñ–º -->
            <div class="form-group">
                <label>
                    <input type="checkbox" id="stream" name="stream">
                    –°—Ç—Ä—ñ–º
                </label>
            </div>

            <div class="form-group">
                <label for="date">–î–∞—Ç–∞:</label>
                <input type="date" id="date" name="date" required title="–û–±–µ—Ä—ñ—Ç—å —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—é –¥–∞—Ç—É –∞–±–æ –¥–∞—Ç—É –∑ –º–∏–Ω—É–ª–æ–≥–æ">
                <small style="color: #666; font-size: 0.85rem; margin-top: 4px; display: block;">
                    üí° –î–æ–∑–≤–æ–ª–µ–Ω–æ: —Å—å–æ–≥–æ–¥–Ω—ñ—à–Ω—è –¥–∞—Ç–∞ —Ç–∞ –º–∏–Ω—É–ª—ñ –¥–∞—Ç–∏
                </small>
            </div>

            <div class="form-group">
                <label for="time">–ß–∞—Å:</label>
                <input type="time" id="time" name="time" required>
            </div>

            <!-- –ü–æ–ª–µ '–¢–∏–ø –º—ñ—Å—ñ—ó' –≤–∏–¥–∞–ª–µ–Ω–æ -->

            <div class="form-group">
                <label for="mission">–û–ø–∏—Å –º—ñ—Å—ñ—ó (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ):</label>
                <textarea id="mission" name="mission" rows="4" placeholder="–û–ø–∏—à—ñ—Ç—å –¥–µ—Ç–∞–ª—ñ –º—ñ—Å—ñ—ó –∞–±–æ –¥–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é..."></textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">–ì–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç</button>
                <button type="reset" class="btn btn-secondary">–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É</button>
            </div>
        </form>

        <div id="reportOutput" class="report-output hidden">
            <h2>–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –∑–≤—ñ—Ç</h2>
            <div id="reportContent" class="report-content"></div>
            <div class="report-actions">
                <button id="copyReport" class="btn btn-outline">–ö–æ–ø—ñ—é–≤–∞—Ç–∏ –∑–≤—ñ—Ç</button>
                <button id="downloadReport" class="btn btn-outline">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–≤—ñ—Ç</button>
                <button id="newReportBasedOn" class="btn btn-secondary">–ù–æ–≤–∏–π –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ</button>
                <button id="newReport" class="btn btn-primary">–ù–æ–≤–∏–π –∑–≤—ñ—Ç</button>
            </div>
        </div>

        <!-- –°–µ–∫—Ü—ñ—è —ñ—Å—Ç–æ—Ä—ñ—ó –∑–≤—ñ—Ç—ñ–≤ -->
        <div id="reportsHistory" class="reports-history" style="display: none;">
            <h2>–Ü—Å—Ç–æ—Ä—ñ—è –∑–≤—ñ—Ç—ñ–≤</h2>
            <div class="history-controls">
                <button id="toggleHistory" class="btn btn-secondary">–ü–æ–∫–∞–∑–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é</button>
                <button id="refreshHistory" class="btn btn-outline" style="display: none;">–û–Ω–æ–≤–∏—Ç–∏</button>
            </div>
            <div id="historyContent" class="history-content" style="display: none;">
                <div class="history-filters">
                    <input type="text" id="searchReports" placeholder="–ü–æ—à—É–∫ –∑–∞ –Ω–æ–º–µ—Ä–æ–º –∑–≤—ñ—Ç—É, –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–æ–º..." class="search-input">
                    <select id="filterBySubdivision" class="filter-select">
                        <option value="">–í—Å—ñ –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–∏</option>
                    </select>
                </div>
                <div id="reportsList" class="reports-list">
                    <!-- –°–ø–∏—Å–æ–∫ –∑–≤—ñ—Ç—ñ–≤ –±—É–¥–µ —Ç—É—Ç -->
                </div>
                <div class="pagination">
                    <button id="prevPage" class="btn btn-outline">‚Üê –ü–æ–ø–µ—Ä–µ–¥–Ω—è</button>
                    <span id="pageInfo">–°—Ç–æ—Ä—ñ–Ω–∫–∞ 1</span>
                    <button id="nextPage" class="btn btn-outline">–ù–∞—Å—Ç—É–ø–Ω–∞ ‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <script src="supabase-functions.js"></script>
    <script src="auth.js"></script>
    <script src="script.js"></script>
    <script src="reports-history.js"></script>
    <script>
        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É/–ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–æ–ª—è –¥–æ–≤–∂–∏–Ω–∏ –∫–æ—Ç—É—à–∫–∏ —Ç–∞ —á–∞—Å—Ç–æ—Ç
        function toggleFiberLength() {
            const checkbox = document.getElementById('fiberOptic');
            const lengthGroup = document.getElementById('fiberLengthGroup');
            const lengthInput = document.getElementById('fiberLength');
            const frequencyRow = document.getElementById('frequencyRow');
            const videoFreqInput = document.getElementById('videoFrequency');
            const controlFreqInput = document.getElementById('controlFrequency');
            
            if (checkbox.checked) {
                // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–ª–µ –¥–æ–≤–∂–∏–Ω–∏ –∫–æ—Ç—É—à–∫–∏
                lengthGroup.style.display = 'block';
                lengthInput.required = true;
                
                // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –≤–µ—Å—å —Ä—è–¥–æ–∫ –∑ —á–∞—Å—Ç–æ—Ç–∞–º–∏ (—ñ –≤—ñ–¥–µ–æ —ñ –∫–µ—Ä—É–≤–∞–Ω–Ω—è)
                if (frequencyRow) {
                    frequencyRow.style.display = 'none';
                }
                videoFreqInput.required = false;
                controlFreqInput.required = false;
                videoFreqInput.value = '';
                controlFreqInput.value = '';
            } else {
                // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –ø–æ–ª–µ –¥–æ–≤–∂–∏–Ω–∏ –∫–æ—Ç—É—à–∫–∏
                lengthGroup.style.display = 'none';
                lengthInput.required = false;
                lengthInput.value = '';
                
                // –ü–æ–∫–∞–∑–∞—Ç–∏ —Ä—è–¥–æ–∫ –∑ —á–∞—Å—Ç–æ—Ç–∞–º–∏ (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ '' —â–æ–± –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ CSS –∫–ª–∞—Å)
                if (frequencyRow) {
                    frequencyRow.style.display = '';
                }
                videoFreqInput.required = true;
                controlFreqInput.required = true;
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –ø–æ–∫–∞–∑—É/–ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –ø–æ–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ–π
        function toggleModifications() {
            const checkbox = document.getElementById('factoryConfig');
            const modificationsGroup = document.getElementById('modificationsGroup');
            const modificationsInput = document.getElementById('modifications');
            
            if (checkbox.checked) {
                // –ó–∞–≤–æ–¥—Å—å–∫–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è - –ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
                modificationsGroup.style.display = 'none';
                modificationsInput.required = false;
                modificationsInput.value = '';
            } else {
                // –ù–µ –∑–∞–≤–æ–¥—Å—å–∫–∞ - –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–ª–µ –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ–π
                modificationsGroup.style.display = 'block';
                modificationsInput.required = false; // –ù–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–µ, –º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º
            }
        }
        
        // –ü–æ–∫—Ä–∞—â–µ–Ω–µ –∞–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–ª—è –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ–π
        document.addEventListener('DOMContentLoaded', function() {
            const modificationsInput = document.getElementById('modifications');
            if (modificationsInput) {
                modificationsInput.addEventListener('input', function(e) {
                    // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è —ñ –ø–æ–∑–∏—Ü—ñ—é –∫—É—Ä—Å–æ—Ä–∞
                    const value = e.target.value;
                    const cursorPos = e.target.selectionStart;
                    
                    // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç (–ø—ñ—Å–ª—è –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –∫–æ–º–∏ –ø–µ—Ä–µ–¥ –∫—É—Ä—Å–æ—Ä–æ–º)
                    const beforeCursor = value.substring(0, cursorPos);
                    const lastCommaIndex = beforeCursor.lastIndexOf(',');
                    const currentItem = beforeCursor.substring(lastCommaIndex + 1).trim();
                    
                    // –õ–æ–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –¥–µ–±–∞–≥—É
                    if (currentItem) {
                        console.log('üîç –ê–≤—Ç–æ–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –¥–ª—è:', currentItem);
                    }
                });
            }
        });
    </script>
    
    <script>
        // ============================================
        // –ê–í–¢–û–ó–ë–ï–†–ï–ñ–ï–ù–ù–Ø –§–û–†–ú–ò –í LOCALSTORAGE
        // ============================================
        
        const FORM_SAVE_KEY = 'droneReportFormData';
        const FORM_SAVE_INTERVAL = 30000; // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥ (–æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è –µ–Ω–µ—Ä–≥–æ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ)
        
        // –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –ø–æ–ª—è —Ñ–æ—Ä–º–∏
        function getFormFields() {
            const form = document.getElementById('reportForm');
            if (!form) return [];
            
            return Array.from(form.querySelectorAll('input, select, textarea')).filter(field => {
                // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø–æ–ª—è –ø–∞—Ä–æ–ª—è —Ç–∞ —ñ–Ω—à—ñ —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ
                return field.type !== 'password' && field.id !== 'loginPassword' && field.id !== 'registerPassword';
            });
        }
        
        // –ó–±–µ—Ä–µ–≥—Ç–∏ —Å—Ç–∞–Ω —Ñ–æ—Ä–º–∏
        function saveFormState() {
            try {
                const fields = getFormFields();
                if (fields.length === 0) {
                    console.warn('[AutoSave] –ù–µ–º–∞—î –ø–æ–ª—ñ–≤ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è');
                    return;
                }
                
                const formData = {};
                let savedCount = 0;
                
                fields.forEach(field => {
                    if (field.type === 'checkbox') {
                        formData[field.id] = field.checked;
                        savedCount++;
                    } else if (field.type === 'radio') {
                        if (field.checked) {
                            formData[field.name] = field.value;
                            savedCount++;
                        }
                    } else if (field.value && field.value.trim() !== '') {
                        formData[field.id] = field.value;
                        savedCount++;
                    }
                });
                
                if (savedCount > 0) {
                    localStorage.setItem(FORM_SAVE_KEY, JSON.stringify(formData));
                    console.log(`[AutoSave] –§–æ—Ä–º—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ (${savedCount} –ø–æ–ª—ñ–≤)`);
                }
            } catch (error) {
                console.error('[AutoSave] –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', error);
            }
        }
        
        // –í—ñ–¥–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞–Ω —Ñ–æ—Ä–º–∏
        function restoreFormState() {
            try {
                const savedData = localStorage.getItem(FORM_SAVE_KEY);
                if (!savedData) {
                    console.log('[AutoSave] –ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è');
                    return;
                }
                
                const formData = JSON.parse(savedData);
                const fields = getFormFields();
                
                if (fields.length === 0) {
                    console.warn('[AutoSave] –ü–æ–ª—è —Ñ–æ—Ä–º–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è');
                    return;
                }
                
                let restoredCount = 0;
                
                fields.forEach(field => {
                    const savedValue = formData[field.id] || formData[field.name];
                    
                    if (savedValue !== undefined && savedValue !== null) {
                        if (field.type === 'checkbox') {
                            field.checked = savedValue;
                            restoredCount++;
                            // –í–∏–∫–ª–∏–∫–∞—Ç–∏ onChange –¥–ª—è —á–µ–∫–±–æ–∫—Å—ñ–≤ (–¥–ª—è toggleFiberLength —Ç–∞ —ñ–Ω—à–∏—Ö)
                            if (field.onchange) {
                                try {
                                    field.onchange();
                                } catch (e) {
                                    console.warn('[AutoSave] –ü–æ–º–∏–ª–∫–∞ –≤–∏–∫–ª–∏–∫—É onchange –¥–ª—è', field.id, e);
                                }
                            }
                        } else if (field.type === 'radio') {
                            if (field.value === savedValue) {
                                field.checked = true;
                                restoredCount++;
                            }
                        } else {
                            field.value = savedValue;
                            restoredCount++;
                            // –í–∏–∫–ª–∏–∫–∞—Ç–∏ onChange –¥–ª—è —Å–µ–ª–µ–∫—Ç—ñ–≤ (–¥–ª—è toggleCustom —Ñ—É–Ω–∫—Ü—ñ–π)
                            if (field.onchange) {
                                try {
                                    field.onchange();
                                } catch (e) {
                                    console.warn('[AutoSave] –ü–æ–º–∏–ª–∫–∞ –≤–∏–∫–ª–∏–∫—É onchange –¥–ª—è', field.id, e);
                                }
                            }
                        }
                    }
                });
                
                console.log(`[AutoSave] –§–æ—Ä–º—É –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ (${restoredCount} –ø–æ–ª—ñ–≤)`);
            } catch (error) {
                console.error('[AutoSave] –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è:', error);
            }
        }
        
        // –û—á–∏—Å—Ç–∏—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–≤—ñ—Ç—É
        function clearSavedFormState() {
            try {
                localStorage.removeItem(FORM_SAVE_KEY);
                console.log('[AutoSave] –ó–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ');
            } catch (error) {
                console.error('[AutoSave] –ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è:', error);
            }
        }
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è (–≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ø—ñ—Å–ª—è –ª–æ–≥—ñ–Ω–∞)
        window.initAutoSave = function() {
            console.log('[AutoSave] –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è');
            
            // –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ –≤–≤–µ–¥–µ–Ω–Ω—ñ
            const fields = getFormFields();
            if (fields.length === 0) {
                console.warn('[AutoSave] –ü–æ–ª—è —Ñ–æ—Ä–º–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                return;
            }
            
            console.log('[AutoSave] –ó–Ω–∞–π–¥–µ–Ω–æ –ø–æ–ª—ñ–≤:', fields.length);
            
            fields.forEach(field => {
                field.addEventListener('input', () => {
                    saveFormState();
                }, { once: false });
                field.addEventListener('change', () => {
                    saveFormState();
                }, { once: false });
            });
            
            // –î–æ–¥–∞—Ç–∫–æ–≤–µ –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–∂–Ω—ñ N —Å–µ–∫—É–Ω–¥ (—Ä—ñ–¥—à–µ, —Ç–æ–º—É —â–æ —î –∞–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ input/change)
            // –¶–µ –ª–∏—à–µ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –Ω–∞ –≤–∏–ø–∞–¥–æ–∫ —è–∫—â–æ –ø–æ–¥—ñ—ó –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–∏
            const saveInterval = setInterval(saveFormState, FORM_SAVE_INTERVAL);
            
            // –û—á–∏—â–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ
            window.addEventListener('beforeunload', () => {
                clearInterval(saveInterval);
            });
            
            // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–∏ –∑–≥–æ—Ä—Ç–∞–Ω–Ω—ñ –¥–æ–¥–∞—Ç–∫—É
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    saveFormState();
                    console.log('[AutoSave] –î–æ–¥–∞—Ç–æ–∫ –∑–≥–æ—Ä–Ω—É—Ç–æ - —Ñ–æ—Ä–º—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ');
                }
            });
            
            // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä–∏—Ç—Ç—è–º
            window.addEventListener('beforeunload', () => {
                saveFormState();
            });
            
            console.log('[AutoSave] –ê–≤—Ç–æ–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ');
        };
        
        // –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ —ñ–Ω—à–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö
        window.saveFormState = saveFormState;
        window.restoreFormState = restoreFormState;
        window.clearSavedFormState = clearSavedFormState;
    </script>
    
    <script>
        // ============================================
        // SERVICE WORKER –ó –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ò–ú –û–ù–û–í–õ–ï–ù–ù–Ø–ú
        // ============================================
        
        if ('serviceWorker' in navigator) {
            let newWorkerWaiting = null;
            
            // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤–µ—Ä—Å—ñ—é
            async function loadVersionInfo() {
                try {
                    const response = await fetch('./version-info.json?' + Date.now());
                    if (!response.ok) throw new Error('Failed to load version info');
                    return await response.json();
                } catch (error) {
                    console.warn('[App] –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ version-info.json:', error);
                    return {
                        version: '?',
                        changes: ['–ù–æ–≤–∞ –≤–µ—Ä—Å—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞!']
                    };
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
            async function showUpdateNotification() {
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤–µ—Ä—Å—ñ—é
                const versionInfo = await loadVersionInfo();
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ —Å—Ç–∏–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 20px 25px;
                    border-radius: 12px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    z-index: 10000;
                    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
                    animation: slideDown 0.3s ease-out;
                    max-width: 400px;
                    width: 90%;
                `;
                
                // –§–æ—Ä–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ –∑–º—ñ–Ω
                const changesList = versionInfo.changes
                    .map(change => `<div style="margin: 5px 0; font-size: 13px;">‚ñ™ ${change}</div>`)
                    .join('');
                
                notification.innerHTML = `
                    <div style="margin-bottom: 12px;">
                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">
                            üéâ –ù–æ–≤–∞ –≤–µ—Ä—Å—ñ—è v${versionInfo.version}
                        </div>
                        <div style="font-size: 14px; opacity: 0.95; margin-bottom: 8px;">
                            –©–æ –Ω–æ–≤–æ–≥–æ:
                        </div>
                        <div style="background: rgba(255,255,255,0.15); padding: 10px; border-radius: 8px; margin-bottom: 12px;">
                            ${changesList}
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button id="updateBtn" style="
                            background: white;
                            color: #667eea;
                            border: none;
                            padding: 10px 25px;
                            border-radius: 6px;
                            font-weight: bold;
                            cursor: pointer;
                            font-size: 14px;
                            flex: 1;
                            max-width: 150px;
                        ">–û–Ω–æ–≤–∏—Ç–∏</button>
                        <button id="dismissBtn" style="
                            background: transparent;
                            color: white;
                            border: 1px solid white;
                            padding: 10px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-size: 14px;
                        ">–ü—ñ–∑–Ω—ñ—à–µ</button>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                document.getElementById('updateBtn').addEventListener('click', () => {
                    if (newWorkerWaiting) {
                        newWorkerWaiting.postMessage({ type: 'SKIP_WAITING' });
                    }
                    notification.remove();
                });
                
                document.getElementById('dismissBtn').addEventListener('click', () => {
                    notification.remove();
                });
                
                console.log('[App] üéâ –ü–æ–∫–∞–∑–∞–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è v' + versionInfo.version);
            }
            
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('[App] ‚úÖ Service Worker –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ');
                        
                        // –ï–Ω–µ—Ä–≥–æ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å
                        let lastUpdateCheck = Date.now();
                        const MIN_UPDATE_INTERVAL = 5 * 60 * 1000; // –ú—ñ–Ω—ñ–º—É–º 5 —Ö–≤–∏–ª–∏–Ω –º—ñ–∂ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞–º–∏
                        
                        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—ñ –¥–æ –≤–∫–ª–∞–¥–∫–∏ (–Ω–µ —á–∞—Å—Ç—ñ—à–µ –Ω—ñ–∂ —Ä–∞–∑ –Ω–∞ 5 —Ö–≤)
                        document.addEventListener('visibilitychange', () => {
                            if (!document.hidden && (Date.now() - lastUpdateCheck) > MIN_UPDATE_INTERVAL) {
                                console.log('[App] üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å (–≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞)');
                                registration.update();
                                lastUpdateCheck = Date.now();
                            }
                        });
                        
                        // –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ (–∫–æ–∂–Ω—ñ 10 —Ö–≤–∏–ª–∏–Ω)
                        const updateInterval = setInterval(() => {
                            if (!document.hidden) {
                                console.log('[App] üîç –ü–µ—Ä—ñ–æ–¥–∏—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω—å');
                                registration.update();
                            }
                        }, 10 * 60 * 1000); // 10 —Ö–≤–∏–ª–∏–Ω
                        
                        // –û—á–∏—â–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ
                        window.addEventListener('beforeunload', () => {
                            clearInterval(updateInterval);
                        });
                        
                        // –í—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω—å
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('[App] üì• –ó–Ω–∞–π–¥–µ–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...');
                            
                            newWorkerWaiting = newWorker;
                            
                            newWorker.addEventListener('statechange', () => {
                                console.log('[App] SW State:', newWorker.state);
                                
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // –ù–æ–≤–∏–π Service Worker –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
                                    console.log('[App] ‚ú® –ù–æ–≤–∞ –≤–µ—Ä—Å—ñ—è –≥–æ—Ç–æ–≤–∞!');
                                    showUpdateNotification();
                                }
                            });
                        });
                        
                        // –Ø–∫—â–æ —î Service Worker, —â–æ —á–µ–∫–∞—î
                        if (registration.waiting) {
                            newWorkerWaiting = registration.waiting;
                            showUpdateNotification();
                        }
                        
                        // –û–¥—Ä–∞–∑—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
                        registration.update();
                    })
                    .catch(error => {
                        console.error('[App] ‚ùå –ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó Service Worker:', error);
                    });
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞
                let refreshing = false;
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (!refreshing) {
                        refreshing = true;
                        console.log('[App] üîÑ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É...');
                        window.location.reload();
                    }
                });
                
                // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ Service Worker
                navigator.serviceWorker.addEventListener('message', event => {
                    if (event.data && event.data.type === 'RELOAD_PAGE') {
                        window.location.reload();
                    }
                });
            });
            
            // CSS –∞–Ω—ñ–º–∞—Ü—ñ—è –¥–ª—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideDown {
                    from {
                        transform: translate(-50%, -100px);
                        opacity: 0;
                    }
                    to {
                        transform: translate(-50%, 0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
        }
    </script>
    </div> <!-- End of appSection -->
</body>
</html>